{% extends 'technician/catalogue/_partials/base.html.twig' %}

{% block title %}Canevas {{ catalogue.canevas.name }}{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row page-titles">
        <div class="col-12">
            <h3 class="text-themecolor">Canevas {{ catalogue.canevas.name }} </h3>
        </div>
        <div class="">
          <button id="open-right-sidebar" class="right-side-toggle waves-effect waves-light btn-success btn btn-circle btn-sm pull-right ml-2"><i class="ti-settings text-white" style="font-size: 1rem !important;"></i></button>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    {% include 'technician/catalogue/_partials/table-canevas.html.twig' with {'displayOnlyProductOfCatalogue': false} %}
                </div>
            </div>
        </div>
    </div>
</div>
<div id="right-sidebar" class="right-sidebar">
    <div class="slimscrollright">
        <div class="rpanel-title"> LISTE PRODUITS CHOISIS <span><i id="close-right-sidebar" class="ti-close right-side-toggle"></i></span>
        </div>
        <div class="r-panel-body">
            <a href="{{ path('catalogue_product_list', {id: catalogue.id}) }}" class="btn btn-success btn-block mt-3">Valider les produits</a>
            <ul class="mt-2" id="products_list">
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
  <script>
    $("#open-right-sidebar").click(function(e){
      let sidebar = $('#right-sidebar');
      $(sidebar).addClass( "shw-rside" )
    });
    $("#close-right-sidebar").click(function(e){
      let sidebar = $('#right-sidebar');
      $(sidebar).removeClass( "shw-rside" )
    });
    $(".isProduct").click(function (e) {
      let name = $(this).text()
      $(this).addClass('btn-light-danger')
      $(this).addClass('exist')
      $.ajax({
        url: '{{ path('catalogue_canevas_add_product') }}',
        type: 'POST',
        data: {
          'btn_id': $(this).attr('btn-id'),
          'catalogue_id': {{ catalogue.id }}
        },
        dataType: 'JSON',
        complete : function (response) {
          $.toast({
            heading: 'Produit ajouté avec succès',
            text: 'Ajout de ' + name,
            position: 'bottom-left',
            loaderBg: '#ff6849',
            icon: 'success',
            hideAfter: 3000,
            stack: 6
          });
          let input = '<li><b>'+ name +'</b></li>'
          $('#products_list').append( input )
        },
        error : function (code_html, status) {
          $.toast({
            heading: 'Une erreur est survenue',
            text: 'Veuillez ressayer',
            position: 'bottom-right',
            loaderBg: '#ff6849',
            icon: 'error',
            hideAfter: 3000,
            stack: 6
          });
        }
      })
    })
  </script>
{% endblock %}

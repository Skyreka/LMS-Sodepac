{% extends printRequest == false
    ? 'base.html.twig'
    : 'print.html.twig' %}

{% block title %}Canevas{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('plugins/toast/toast.css') }}" rel="stylesheet">
    <style>
        .table thead th {
            padding-left: 15px;
            padding-right: 15px;
            text-align: center;
        }
        .btn-R {
            background-color: #FFADAD !important;
        }
        .btn-O {
            background-color: #FFD6A5 !important;
        }
        .btn-J {
            background-color: #FDFFB6 !important;
        }
        .btn-V {
            background-color: #CAFFBF !important;
        }
        .btn-C {
            background-color: #9BF6FF !important;
        }
        .btn-B {
            background-color: #A0C4FF !important;
        }
        .btn-M {
            background-color: #FFC6FF !important;
        }
        .btn-A {
            background-color: #D8E2DC !important;
        }
        .exist {
            border: 3px solid grey;
        }
    </style>
{% endblock %}

{% block body %}
    {% if printRequest == false %}
            <div class="container-fluid">
            <div class="row page-titles">
                <div class="col-md-5 col-8 align-self-center">
                    <h3 class="text-themecolor">Canevas {{ culture.name }} <span class="badge badge-warning">Taille total {{ totalSize }} ha</span></h3>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ path('login_success') }}">Accueil</a></li>
                        <li class="breadcrumb-item"><a href="{{ path('recommendations.select') }}">Recommandation</a></li>
                        <li class="breadcrumb-item"><a href="javascript:void(0)">Canevas</a></li>
                        <li class="breadcrumb-item active">{{ culture.name }}</li>
                    </ol>
                </div>
                <div class="">
                    <button id="open-right-sidebar" class="right-side-toggle waves-effect waves-light btn-success btn btn-circle btn-sm pull-right ml-2"><i class="ti-settings text-white"></i></button>
                </div>
            </div>
            <div class="row">
            <div class="col-lg-12">
            <div class="card">
            <div class="card-body">
       {% endif  %}
                    <div class="table-responsive">
                        <table class="table table-bordered no-wrap">
                            <thead>
                            <tr>
                                <th></th>
                                <th>
                                    Semis
                                </th>
                                <th>
                                    Corylédons
                                </th>
                                <th>
                                    1 feuille
                                </th>
                                <th>
                                    3 feuilles
                                </th>
                                <th>
                                    4 feuilles
                                </th>
                                <th>
                                    6 feuilles
                                </th>
                                <th>
                                    Rosette
                                </th>
                                <th>
                                    Entre-noeuds <br>visibles
                                </th>
                                <th>
                                    Boutons accolés <br>encore cachés <br>pour les feuilles <br>terminales
                                </th>
                                <th>
                                    Inflores <br>principales <br>dégagés
                                </th>
                                <th>
                                    Boutons <br>séparés
                                </th>
                                <th>
                                    Début floraison <br>fleur ouverte
                                </th>
                                <th>
                                    Chute des <br>premiers pétales
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FERTILISATION</td>
                                    <td>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-0-12-24-sp') ? 'exist' : 'd-none' }}" product_slug="s-0-12-24-sp">0-12-24</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-super-25') ? 'exist' : 'd-none' }}" product_slug="s-super-25">SUPER 25</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-0-20-20-sp') ? 'exist' : 'd-none' }}" product_slug="s-0-20-20-sp">0-20-20</button>
                                    </td>
                                    <td>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-ino-loc-micro-pz-10-40-11-so3-2-zn-10-kg') ? 'exist' : 'd-none' }}" product_slug="s-ino-loc-micro-pz-10-40-11-so3-2-zn-10-kg" dose="20" unit="Kg">INO LOC<small> 20 Kg</small></button>
                                        <button class="btn-C btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-rise-p-1-kg') ? 'exist' : 'd-none' }}" product_slug="s-rise-p-1-kg" dose="150" unit="Kg">RISE P<small> 150 Kg</small></button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-8-10-22') ? 'exist' : 'd-none' }}" product_slug="s-8-10-22">8-10-22</button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="5">
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-sulfonitrate-26') ? 'exist' : 'd-none' }}" product_slug="s-sulfonitrate-26">SULFONITRATE</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-nelix-lintec-36-24-so3') ? 'exist' : 'd-none' }}" product_slug="s-nelix-lintec-36-24-so3">NELIX 36 + 24 SO3</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-azote-26-13-so3') ? 'exist' : 'd-none' }}" product_slug="s-azote-26-13-so3">AZOTE 26 + 13 SO3</button>
                                    </td>
                                    <td colspan="2">
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-sulfonitrate-26') ? 'exist' : 'd-none' }}" product_slug="s-sulfonitrate-26">SULFONITRATE</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-nelix-lintec-36-24-so3') ? 'exist' : 'd-none' }}" product_slug="s-nelix-lintec-36-24-so3">NELIX 36 + 24 SO3</button>
                                        <button class="btn-B btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-azote-26-13-so3') ? 'exist' : 'd-none' }}" product_slug="s-azote-26-13-so3">AZOTE 26 + 13 SO3</button>
                                    </td>
                                </tr>
                                <tr>
                                   <td>INSECICIDES <br>DU SOL</td>
                                   <td></td>
                                   <td>
                                    <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-trika-expert-10-kg') ? 'exist' : 'd-none' }}" product_slug="s-trika-expert-10-kg" dose="15" unit="Kg">TRIKA EXPERT <small>15 Kg</small></button>
                                   </td>
                                   <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>ANTI LIMACES</td>
                                    <td></td>
                                    <td>
                                        <button class="btn-C btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-ironmax-mg-15-kg') ? 'exist' : 'd-none' }}" product_slug="s-ironmax-mg-15-kg" dose="1" unit="Dose/Ha">IRON MAX MG <small>1 Dose/Ha</small></button>
                                    </td>
                                    <td colspan="4">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-helexiom-duo-18-kg') ? 'exist' : 'd-none' }}" product_slug="s-helexiom-duo-18-kg" dose="4.5" unit="Kg">HELEXIOM DUO <small>4.5 Kg</small></button>
                                        <button class="btn-C btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'ironmax-pro') ? 'exist' : 'd-none' }}" product_slug="ironmax-pro" dose="7" unit="Kg">IRON MAX PRO <small>7 Kg</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>ALTISES <br>D'HIVER</td>
                                    <td></td><td></td>
                                    <td colspan="5">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-karate-xflow-5-l', '0.05') ? 'exist' : 'd-none' }}" product_slug="s-karate-xflow-5-l" dose="0.05" unit="L">KARATE XFLOW <small>0.05 L</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'boravi-wg', '1.5') ? 'exist' : 'd-none' }}" product_slug="boravi-wg" dose="1.5" unit="Kg">BORAVI <small>1.5 Kg</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '0.3') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="0.3" unit="L">COUNTRY GOLD <small>0.3 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>CHARANCONS <br>DU BOURGEON <br>TERMINAL</td>
                                    <td></td><td></td><td></td><td></td>
                                    <td colspan="3">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-karate-xflow-5-l', '0.075') ? 'exist' : 'd-none' }}" product_slug="s-karate-xflow-5-l" dose="0.075" unit="L">KARATE XFLOW <small>0.075 L</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'boravi-wg', '1.501') ? 'exist' : 'd-none' }}" product_slug="boravi-wg" dose="1.501" unit="Kg">BORAVI <small>1.5 Kg</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '0.301') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="0.301" unit="L">COUNTRY GOLD <small>0.3 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>CHARANCONS <br>DE LA TIGE</td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="4">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-karate-xflow-5-l', '0.07501') ? 'exist' : 'd-none' }}" product_slug="s-karate-xflow-5-l" dose="0.07501" unit="L">KARATE XFLOW <small>0.075 L</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'boravi-wg', '1.502') ? 'exist' : 'd-none' }}" product_slug="boravi-wg" dose="1.502" unit="Kg">BORAVI <small>1.5 Kg</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '0.302') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="0.302" unit="L">COUNTRY GOLD <small>0.3 L</small></button>
                                    </td>
                                    <td></td><td></td>
                                </tr>
                                <tr>
                                    <td>MELIGETHES</td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="4">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-karate-xflow-5-l', '0.07502') ? 'exist' : 'd-none' }}" product_slug="s-karate-xflow-5-l" dose="0.07502" unit="L">KARATE XFLOW <small>0.075 L</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'boravi-wg', '1.503') ? 'exist' : 'd-none' }}" product_slug="boravi-wg" dose="1.503" unit="Kg">BORAVI <small>1.5 Kg</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '0.303') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="0.303" unit="L">COUNTRY GOLD <small>0.3 L</small></button>
                                    </td>
                                    <td></td><td></td>
                                </tr>
                                <tr>
                                    <td>CHARANCON <br>DES SILIQUES</td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="2">
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-karate-xflow-5-l', '0.051') ? 'exist' : 'd-none' }}" product_slug="s-karate-xflow-5-l" dose="0.051" unit="L">KARATE XFLOW <small>0.075 L</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'boravi-wg', '1.504') ? 'exist' : 'd-none' }}" product_slug="boravi-wg" dose="1.504" unit="Kg">BORAVI <small>1.5 Kg</small></button>
                                        <button class="btn-R btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '0.304') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="0.304" unit="L">COUNTRY GOLD <small>0.3 L</small></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>OLIGO <br>ELEMENTS</td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="3">
                                        <button class="btn-M btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-ino-boost-bmo-10-l', '3') ? 'exist' : 'd-none' }}" product_slug="s-ino-boost-bmo-10-l" dose="3" unit="L">INO BOOST BMO<small> 3 L</small></button>
                                        <button class="btn-M btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-country-gold-1-l', '10') ? 'exist' : 'd-none' }}" product_slug="s-country-gold-1-l" dose="10" unit="L">INO SOUFRE N<small> 10 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>DESHERBAGE <br>SEMIS EN <br>INCORPATION</td>
                                    <td>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-naprop-450-5-l', '2.8') ? 'exist' : 'd-none' }}" product_slug="s-naprop-450-5-l" dose="2.8" unit="L">NAPRO<small> 2.8 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>DESHERBAGE <br>POST SEMIS <br>PRE LEVEE</td>
                                    <td></td>
                                    <td>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-pack-canopy-pantera-sultan-5-afaena-1', '1') ? 'exist' : 'd-none' }}" product_slug="s-pack-canopy-pantera-sultan-5-afaena-1" dose="1" unit="Pack/5Ha">PACK CANOPY / PANTHERA<small> 1 Pack/5Ha</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td rowspan="2">DESHERBAGE <br>PRELEVEE <br>ET PRECOCE</td>
                                    <td></td>
                                    <td colspan="5">
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'novall', '2.5') ? 'exist' : 'd-none' }}" product_slug="novall" dose="2.5" unit="L">NOVALL<small> 2.5 L</small></button>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-pack-solanis-butisan-5-5', '1') ? 'exist' : 'd-none' }}" product_slug="s-pack-solanis-butisan-5-5" dose="1" unit="Pack/5Ha">PACK SOLANIS BUTISAN<small> 1 Pack/5Ha</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td></td><td></td>
                                    <td colspan="4">
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'mozzar', '0.25') ? 'exist' : 'd-none' }}" product_slug="mozzar" dose="0.25" unit="L">MOZZAR<small> 0.25 L</small></button>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'fox', '1') ? 'exist' : 'd-none' }}" product_slug="fox" dose="1" unit="L">FOX<small> 1 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>DESHERBAGE <br>POST LEVEE</td>
                                    <td></td><td></td>
                                    <td colspan="4">
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-yago-5-l', '1.5') ? 'exist' : 'd-none' }}" product_slug="s-yago-5-l" dose="1.5" unit="L">YAGO<small> 1.5 L</small></button>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'callisto', '0.30') ? 'exist' : 'd-none' }}" product_slug="callisto" dose="0.30" unit="L">CALLISTO<small> 0.30 L</small></button>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'lontrel-100', '174') ? 'exist' : 'd-none' }}" product_slug="lontrel-100" dose="174" unit="g">LONTREL<small> 174 g</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>
                                    <td>ANTI GRAMINEES <br>SPECIFIQUES</td>
                                    <td></td><td></td>
                                    <td colspan="4">
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'kerb-flo', '1.875') ? 'exist' : 'd-none' }}" product_slug="kerb-flo" dose="1.875" unit="L">KERB FLO<small> 1.875 L</small></button>
                                        <button class="btn-J btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'stratos-ultra', '4') ? 'exist' : 'd-none' }}" product_slug="stratos-ultra" dose="4" unit="L">STRATOS ULTRA<small> 4 L</small></button>
                                    </td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                </tr>
                                <tr>    `
                                    <td>FONGICIDES</td>
                                    <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                                    <td colspan="6">
                                        <button class="btn-V btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'zakeo-xtra', '1') ? 'exist' : 'd-none' }}" product_slug="zakeo-xtra" dose="1" unit="L">ZAKEO XTRA<small> 1 L</small></button>
                                        <button class="btn-V btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 'prosaro', '1') ? 'exist' : 'd-none' }}" product_slug="prosaro" dose="1" unit="L">PROSARO<small> 1 L</small></button>
                                        <button class="btn-V btn btn-block isProduct {{ printRequest ? rpr.productExist( recommendations, 's-jetset-5-l', '0.4') ? 'exist' : 'd-none' }}" product_slug="s-jetset-5-l" dose="0.4" unit="L">JET SET<small> 0.4 L</small></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% if printRequest == false %}
               <div class="alert alert-success">SODEPAC est certifiée CSA-GTP (Sécurité Sanitaire) N°GT090087 et 2BSsv (Durabilité Agro Carburants) N°2BS030038 <br> Distribution de produits Phytopharmaceutiques à des utilisateurs professionnels et non professionnels. N°Agrément: 4700008 </div>
            {% endif %}
        </div>
    </div>
    {% if printRequest == false %}
        <div id="right-sidebar" class="right-sidebar">
            <div class="slimscrollright">
                <div class="rpanel-title"> LISTE PRODUITS CHOISIS <span><i id="close-right-sidebar" class="ti-close right-side-toggle"></i></span>
                </div>
                <div class="r-panel-body">
                    <a href="{{ path('recommendations.synthese.products', {id: recommendations.id}) }}" class="btn btn-success btn-block mt-3">Valider les produits</a>
                    <ul class="mt-2" id="products_list">
                    </ul>
                </div>

            </div>
        </div>
    {% endif %}
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('plugins/toast/toast.js') }}"></script>
    <script>
        $("#open-right-sidebar").click(function(e){
            let sidebar = $('#right-sidebar');
            $(sidebar).addClass( "shw-rside" )
        });
        $("#close-right-sidebar").click(function(e){
            let sidebar = $('#right-sidebar');
            $(sidebar).removeClass( "shw-rside" )
        });
        $(".isProduct").click(function (e) {
            let name = $(this).text()
            $(this).addClass('btn-light-danger')
            $(this).addClass('exist')
            $.ajax({
                url: '/recommendations/add-product',
                type: 'POST',
                data: {
                    'product_slug': $(this).attr('product_slug'),
                    'recommendation_id': {{ recommendations.id }},
                    'dose': $(this).attr('dose'),
                    'unit': $(this).attr('unit')
                },
                dataType: 'JSON',
                complete : function (response) {
                    $.toast({
                        heading: 'Produit ajouté avec succès',
                        text: 'Ajout de ' + name,
                        position: 'bottom-left',
                        loaderBg: '#ff6849',
                        icon: 'success',
                        hideAfter: 3000,
                        stack: 6
                    });
                    let nameProduct = response.responseJSON['name_product']
                    let dose = response.responseJSON['dose']
                    let unit = response.responseJSON['unit']
                    let input = '<li><b>'+ nameProduct +'</b> <small>'+ dose + unit +'</small></li>'
                    $('#products_list').append( input )
                },
                error : function (code_html, status) {
                    $.toast({
                        heading: 'Une erreur est survenue',
                        text: 'Veuillez ressayer',
                        position: 'bottom-right',
                        loaderBg: '#ff6849',
                        icon: 'error',
                        hideAfter: 3000,
                        stack: 6
                    });
                }
            })
        })
    </script>
{% endblock %}